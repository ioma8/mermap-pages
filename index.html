<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mermap - Markdown + Mermaid Viewer</title>
    <meta
      name="description"
      content="Mermap is a fast offline desktop app for viewing Markdown documents with Mermaid diagrams."
    />
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&family=Sora:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="bg-grid" aria-hidden="true"></div>
    <header class="topbar">
      <div class="brand">
        <img src="./logo_2.svg" alt="Mermap logo" class="logo" />
        <span>Mermap</span>
      </div>
    </header>

    <main>
      <section class="hero">
        <p class="eyebrow">Offline markdown + mermaid desktop viewer</p>
        <h1>Read docs and diagrams at full speed.</h1>
        <p class="lead">
          Mermap opens Markdown with Mermaid diagrams instantly, keeps everything local, and gives you native desktop file workflows.
        </p>
        <div class="cta-row">
          <a class="btn primary" href="#downloads">Download bundles</a>
        </div>
      </section>

      <section class="preview">
        <h2>App preview</h2>
        <img
          src="./SCR-20260224-ngnu.png"
          alt="Mermap application screenshot"
          class="app-shot"
          loading="lazy"
        />
      </section>

      <section class="cards">
        <article class="card">
          <h2>Why Mermap</h2>
          <ul>
            <li>Renders full Markdown + Mermaid inline</li>
            <li>Zoom/pan and fullscreen for any diagram</li>
            <li>Export diagrams to image files (PNG/SVG)</li>
            <li>Tabs + persisted recent files</li>
            <li>A4 PDF export of current tab</li>
            <li>Single-instance app behavior like native preview apps</li>
            <li>No CDN dependency - fully offline</li>
          </ul>
        </article>

        <article class="card">
          <h2>File workflows</h2>
          <ul>
            <li>Open from menu, drag-drop, or CLI args</li>
            <li>Set as default for <code>.md</code>, <code>.markdown</code>, <code>.mmd</code>, <code>.mermaid</code></li>
            <li>External links open in your system browser</li>
            <li>Works on macOS, Windows, and Linux</li>
          </ul>
        </article>
      </section>

      <section class="downloads card" id="downloads">
        <h2 id="downloads-title">Download bundles (latest)</h2>
        <div class="download-grid" id="download-grid">
          <p class="downloads-note">Loading latest release assets...</p>
        </div>
      </section>
    </main>

    <footer>
      <p>Built with Tauri + Preact + Mermaid. Â© Mermap</p>
    </footer>

    <script>
      (function () {
        const repo = "ioma8/mermap-pages";
        const apiUrl = `https://api.github.com/repos/${repo}/releases/latest`;
        const grid = document.getElementById("download-grid");
        const title = document.getElementById("downloads-title");
        if (!grid || !title) return;

        function classify(name) {
          const lower = name.toLowerCase();
          if (lower.endsWith(".dmg")) return "macOS (.dmg)";
          if (lower.endsWith(".exe")) return "Windows (.exe installer)";
          if (lower.endsWith(".msi")) return "Windows (.msi)";
          if (lower.endsWith(".appimage")) return "Linux (.AppImage)";
          if (lower.endsWith(".deb")) return "Linux (.deb)";
          if (lower.endsWith(".rpm")) return "Linux (.rpm)";
          return null;
        }

        fetch(apiUrl, { headers: { Accept: "application/vnd.github+json" } })
          .then((res) => {
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            return res.json();
          })
          .then((release) => {
            const tag = release.tag_name || "latest";
            title.textContent = `Download bundles (${tag})`;

            const seen = new Set();
            const items = (release.assets || [])
              .map((asset) => {
                const label = classify(asset.name || "");
                if (!label) return null;
                if (seen.has(label)) return null;
                seen.add(label);
                return { label, url: asset.browser_download_url };
              })
              .filter(Boolean);

            if (!items.length) {
              grid.innerHTML = '<p class="downloads-note">No downloadable assets found in the latest release yet.</p>';
              return;
            }

            grid.innerHTML = "";
            for (const item of items) {
              const a = document.createElement("a");
              a.className = "btn";
              a.href = item.url;
              a.textContent = item.label;
              grid.appendChild(a);
            }
          })
          .catch(() => {
            grid.innerHTML =
              '<p class="downloads-note">Could not load assets automatically. Open releases: <a href="https://github.com/ioma8/mermap-pages/releases">ioma8/mermap-pages/releases</a></p>';
          });
      })();
    </script>
  </body>
</html>
